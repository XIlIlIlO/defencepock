<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î∞©Ïñ¥Ìè≠ Í≥ÑÏÇ∞Í∏∞ (Long/Short Íµ¨Î∂Ñ)</title>
    <style>
        :root {
            --color-white: rgba(255, 255, 255, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-gray-400-rgb: 119, 124, 124;
            
            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-charcoal-700);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-input-bg: rgba(255, 255, 200, 0.3);
            --color-output-bg: rgba(200, 180, 255, 0.2);
            
            --font-family-base: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --space-8: 8px;
            --space-12: 12px;
            --space-16: 16px;
            --space-24: 24px;
            --radius-base: 8px;
            --radius-lg: 12px;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-300);
                --color-text-secondary: rgba(var(--color-gray-300), 0.7);
                --color-primary: var(--color-teal-300);
                --color-border: rgba(var(--color-gray-400-rgb), 0.3);
                --color-input-bg: rgba(255, 255, 100, 0.15);
                --color-output-bg: rgba(180, 160, 255, 0.15);
            }
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family-base);
            background: var(--color-background);
            color: var(--color-text);
            margin: 0;
            padding: var(--space-24);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: var(--space-24);
            color: var(--color-text);
        }

        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-24);
            margin-bottom: var(--space-24);
        }

        @media (max-width: 768px) {
            .calculator-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: var(--space-24);
        }

        .card h2 {
            margin-top: 0;
            margin-bottom: var(--space-16);
            font-size: 1.25rem;
            color: var(--color-text);
        }

        .input-section {
            background: var(--color-input-bg);
            padding: var(--space-16);
            border-radius: var(--radius-base);
            margin-bottom: var(--space-16);
        }

        .output-section {
            background: var(--color-output-bg);
            padding: var(--space-16);
            border-radius: var(--radius-base);
        }

        .form-group {
            margin-bottom: var(--space-16);
        }

        label {
            display: block;
            margin-bottom: var(--space-8);
            font-weight: 500;
            color: var(--color-text);
        }

        input[type="number"] {
            width: 100%;
            padding: var(--space-12);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            font-size: 1rem;
            background: var(--color-surface);
            color: var(--color-text);
        }

        input[type="number"]:focus {
            outline: 2px solid var(--color-primary);
            outline-offset: 2px;
        }

        .btn {
            width: 100%;
            padding: var(--space-12) var(--space-16);
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--radius-base);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn:hover {
            background: var(--color-primary-hover);
        }

        .result-grid {
            display: grid;
            gap: var(--space-12);
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: var(--space-12);
            background: var(--color-surface);
            border-radius: var(--radius-base);
            border: 1px solid var(--color-border);
        }

        .result-label {
            font-weight: 500;
            color: var(--color-text-secondary);
        }

        .result-value {
            font-weight: 600;
            color: var(--color-text);
            font-size: 1.1rem;
        }

        .dca-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--space-16);
        }

        .dca-table th,
        .dca-table td {
            padding: var(--space-8);
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }

        .dca-table th {
            background: var(--color-input-bg);
            font-weight: 600;
        }

        .dca-table input {
            width: 100%;
            padding: var(--space-8);
        }

        .add-dca-btn {
            width: auto;
            padding: var(--space-8) var(--space-16);
            margin-bottom: var(--space-16);
            background: var(--color-text-secondary);
        }

        .add-dca-btn:hover {
            background: var(--color-slate-500);
        }

        .remove-btn {
            padding: var(--space-8);
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .remove-btn:hover {
            background: #cc0000;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ°Ô∏è Î∞©Ïñ¥Ìè≠ Í≥ÑÏÇ∞Í∏∞ (Long/Short Íµ¨Î∂Ñ)</h1>
        
        <div class="calculator-grid">
            <!-- Input Section -->
            <div class="card">
                <h2>üìä Í∏∞Î≥∏ ÏÑ§Ï†ï</h2>
                <div class="input-section">
                    <div class="form-group">
                        <label for="dcaSize">DCA Size (Ï¥àÍ∏∞ ÏÇ¨Ïù¥Ï¶à)</label>
                        <input type="number" id="dcaSize" value="10" step="1">
                    </div>
                    <div class="form-group">
                        <label for="leverage">Leverage (Î†àÎ≤ÑÎ¶¨ÏßÄ)</label>
                        <input type="number" id="leverage" value="20" step="1">
                    </div>
                    <div class="form-group">
                        <label for="stopLoss">SL (ÏÜêÏ†à %)</label>
                        <input type="number" id="stopLoss" value="700" step="10">
                    </div>
                </div>

                <h2>üìà DCA Îã®Í≥Ñ ÏÑ§Ï†ï</h2>
                <button class="btn add-dca-btn" onclick="addDcaStep()">+ DCA Îã®Í≥Ñ Ï∂îÍ∞Ä</button>
                <div style="overflow-x: auto;">
                    <table class="dca-table">
                        <thead>
                            <tr>
                                <th>Îã®Í≥Ñ</th>
                                <th>DCA Size</th>
                                <th>‚àá% (Î≥ÄÎèôÎ•†)</th>
                                <th>ÏÇ≠Ï†ú</th>
                            </tr>
                        </thead>
                        <tbody id="dcaSteps">
                            <!-- DCA steps will be added here dynamically -->
                        </tbody>
                    </table>
                </div>

                <button class="btn" onclick="calculate()">Í≥ÑÏÇ∞ÌïòÍ∏∞</button>
            </div>

            <!-- Output Section -->
            <div class="card">
                <h2>üìã Í≥ÑÏÇ∞ Í≤∞Í≥º</h2>
                <div class="output-section">
                    <div class="result-grid">
                        <div class="result-item">
                            <span class="result-label">Î∞©Ïñ¥Ìè≠ Í≤∞Í≥ºÍ∞í</span>
                            <span class="result-value" id="resultTotal">-</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">L Î∞©Ïñ¥Ìè≠ (Long)</span>
                            <span class="result-value" id="resultLong">-</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">S Î∞©Ïñ¥Ìè≠ (Short)</span>
                            <span class="result-value" id="resultShort">-</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">ÏòàÏÉÅ ÏÜêÏ†à Í∏àÏï°</span>
                            <span class="result-value" id="expectedLoss">-</span>
                        </div>
                    </div>
                </div>

                <div style="margin-top: var(--space-24);">
                    <h3>üí° Í≥ÑÏÇ∞ ÏÑ§Î™Ö</h3>
                    <ul style="font-size: 0.9rem; color: var(--color-text-secondary);">
                        <li><strong>Î∞©Ïñ¥Ìè≠ Í≤∞Í≥ºÍ∞í:</strong> Ï†ÑÏ≤¥ ÎàÑÏ†Å Î≥ÄÎèôÎ•† / Î†àÎ≤ÑÎ¶¨ÏßÄ</li>
                        <li><strong>L Î∞©Ïñ¥Ìè≠:</strong> Long Ìè¨ÏßÄÏÖòÏùò ÌèâÍ∑†Í∞Ä ÎåÄÎπÑ Î∞©Ïñ¥Ìè≠ %</li>
                        <li><strong>S Î∞©Ïñ¥Ìè≠:</strong> Short Ìè¨ÏßÄÏÖòÏùò ÌèâÍ∑†Í∞Ä ÎåÄÎπÑ Î∞©Ïñ¥Ìè≠ %</li>
                        <li><strong>ÏòàÏÉÅ ÏÜêÏ†à Í∏àÏï°:</strong> (Ï¥ù ÎßàÏßÑ √ó SL%) / 100</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize with default DCA steps
        function initializeDcaSteps() {
            const defaultSteps = [
                { size: 10, changePercent: 30 },
                { size: 10, changePercent: 60 },
                { size: 10, changePercent: 90 },
                { size: 10, changePercent: 130 },
                { size: 10, changePercent: 180 },
                { size: 10, changePercent: 240 },
                { size: 10, changePercent: 320 },
                { size: 10, changePercent: 400 }
            ];

            defaultSteps.forEach(step => {
                addDcaStepWithValues(step.size, step.changePercent);
            });
        }

        function addDcaStep() {
            addDcaStepWithValues(10, 0);
        }

        function addDcaStepWithValues(size, changePercent) {
            const tbody = document.getElementById('dcaSteps');
            const rowCount = tbody.rows.length;
            const row = tbody.insertRow();
            
            row.innerHTML = `
                <td>${rowCount + 1}</td>
                <td><input type="number" class="dca-size" value="${size}" step="1"></td>
                <td><input type="number" class="dca-change" value="${changePercent}" step="1"></td>
                <td><button class="remove-btn" onclick="removeDcaStep(this)">ÏÇ≠Ï†ú</button></td>
            `;
        }

        function removeDcaStep(btn) {
            const row = btn.closest('tr');
            row.remove();
            updateStepNumbers();
        }

        function updateStepNumbers() {
            const tbody = document.getElementById('dcaSteps');
            Array.from(tbody.rows).forEach((row, index) => {
                row.cells[0].textContent = index + 1;
            });
        }

        function calculate() {
            // Get basic inputs
            const initialSize = parseFloat(document.getElementById('dcaSize').value) || 0;
            const leverage = parseFloat(document.getElementById('leverage').value) || 1;
            const stopLoss = parseFloat(document.getElementById('stopLoss').value) || 0;

            // Get DCA steps
            const dcaSizes = [initialSize];
            const changePercents = [0]; // First step has 0% change
            
            const rows = document.getElementById('dcaSteps').rows;
            for (let i = 0; i < rows.length; i++) {
                const sizeInput = rows[i].querySelector('.dca-size');
                const changeInput = rows[i].querySelector('.dca-change');
                dcaSizes.push(parseFloat(sizeInput.value) || 0);
                changePercents.push(parseFloat(changeInput.value) || 0);
            }

            // Calculate results
            const results = calculateDefenseRange(dcaSizes, changePercents, leverage, stopLoss);

            // Display results
            document.getElementById('resultTotal').textContent = results.totalDefense.toFixed(2) + '%';
            document.getElementById('resultLong').textContent = results.longDefense.toFixed(2) + '%';
            document.getElementById('resultShort').textContent = results.shortDefense.toFixed(2) + '%';
            document.getElementById('expectedLoss').textContent = results.expectedLoss.toFixed(2);
        }

        function calculateDefenseRange(sizes, changePercents, leverage, stopLoss) {
            const n = sizes.length;
            
            // Calculate cumulative sizes
            const cumulativeSizes = [];
            let sum = 0;
            for (let i = 0; i < n; i++) {
                sum += sizes[i];
                cumulativeSizes.push(sum);
            }

            // Calculate DCA ROI and cumulative percentage
            const dcaRoi = [0]; // First element is 0
            const cumulativePercent = [0];
            
            for (let i = 1; i < n; i++) {
                const roi = (1 - (sizes[i] / cumulativeSizes[i])) * changePercents[i];
                dcaRoi.push(roi);
                cumulativePercent.push(changePercents[i] - dcaRoi[i - 1]);
            }

            // Calculate total defense range (Î∞©Ïñ¥Ìè≠ Í≤∞Í≥ºÍ∞í)
            const sumCumulativePercent = cumulativePercent.reduce((a, b) => a + b, 0);
            const totalDefense = sumCumulativePercent / leverage;

            // Calculate Long defense (L Î∞©Ïñ¥Ìè≠)
            const longPrices = [1]; // Initial price = 1
            const longAvgPrices = [1]; // Initial average price = 1
            const longCoinCounts = [sizes[0] / 1]; // Initial coin count
            const longCumulativeCoinCounts = [sizes[0] / 1];
            
            for (let i = 1; i < n; i++) {
                const prevAvgPrice = longAvgPrices[i - 1];
                const newPrice = prevAvgPrice * (100 - (changePercents[i] / leverage)) / 100;
                longPrices.push(newPrice);
                
                const coinCount = sizes[i] / newPrice;
                longCoinCounts.push(coinCount);
                
                const cumulativeCoinCount = longCumulativeCoinCounts[i - 1] + coinCount;
                longCumulativeCoinCounts.push(cumulativeCoinCount);
                
                const avgPrice = cumulativeSizes[i] / cumulativeCoinCount;
                longAvgPrices.push(avgPrice);
            }
            
            const finalLongAvgPrice = longAvgPrices[n - 1];
            const longDefense = (1 - (finalLongAvgPrice * (100 - (stopLoss / leverage)) / 100)) * 100;

            // Calculate Short defense (S Î∞©Ïñ¥Ìè≠)
            const shortPrices = [1]; // Initial price = 1
            const shortAvgPrices = [1]; // Initial average price = 1
            const shortCoinCounts = [sizes[0] / 1]; // Initial coin count
            const shortCumulativeCoinCounts = [sizes[0] / 1];
            
            for (let i = 1; i < n; i++) {
                const prevAvgPrice = shortAvgPrices[i - 1];
                const newPrice = prevAvgPrice * (100 + (changePercents[i] / leverage)) / 100;
                shortPrices.push(newPrice);
                
                const coinCount = sizes[i] / newPrice;
                shortCoinCounts.push(coinCount);
                
                const cumulativeCoinCount = shortCumulativeCoinCounts[i - 1] + coinCount;
                shortCumulativeCoinCounts.push(cumulativeCoinCount);
                
                const avgPrice = cumulativeSizes[i] / cumulativeCoinCount;
                shortAvgPrices.push(avgPrice);
            }
            
            const finalShortAvgPrice = shortAvgPrices[n - 1];
            const shortDefense = ((finalShortAvgPrice * (100 + (stopLoss / leverage)) / 100) - 1) * 100;

            // Calculate expected loss (ÏòàÏÉÅ ÏÜêÏ†à Í∏àÏï°)
            const totalMargin = cumulativeSizes[n - 1] / leverage;
            const expectedLoss = (totalMargin * stopLoss) / 100;

            return {
                totalDefense,
                longDefense,
                shortDefense,
                expectedLoss
            };
        }

        // Initialize on page load
        window.onload = function() {
            initializeDcaSteps();
            calculate();
        };
    </script>
</body>
</html>
